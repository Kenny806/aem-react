<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AEM React</title>

    <!-- Bootstrap -->
    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="highlight.js/styles/github.css">
    <link rel="stylesheet" href="main.css"/>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-87337951-1', 'auto');
        ga('send', 'pageview');

    </script>

</head>
<body>
    <div class="js_header bs-docs-header" id="content" tabindex="-1">
        <div class="container">
            <h1>AEM React</h1>
            <p>AEM components written in React</p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-9" style="position:relative">
                    <h2 id="nav_0">1 Introduction</h2>
                    
                        <p>The goal of the AEM (<a href="http://www.adobe.com/de/marketing-cloud/enterprise-content-management.html">Adobe Experience Manager</a>) React library is to use <a href="https://facebook.github.io/react/">React</a> as a templating engine
for AEM components. React is a popular javascript ui library by facebook.</p>
<h3>Why React and AEM?</h3><p>React components are ideal to create web applications with complex client-side interactivity. AEM provides a perfect authoring interface for web content.
This project brings these technologies together, so that you can build highly interactive web pages with a professional authoring tool.</p>
<h3>Features</h3><ul>
<li><a href="http://www.2ality.com/2015/08/isomorphic-javascript.html">Universal</a> React rendering</li>
<li>High performance javascript execution with a pool of Java 8 <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/">nashorn</a> engines.</li>
<li>Nesting React components in other AEM components and vice versa is supported.</li>
<li>Converting vanilla (plain) react components into AEM components is supported.</li>
<li>SPA based on react router is supported.</li>
</ul>
<h3>Projects</h3><h4>AEM project</h4><p>The <a href="https://github.com/sinnerschrader/aem-react">aem-react project</a> consists of the following parts:</p>
<ul>
<li>osgi bundle contains the Sling Script Engine to render AEM components written in react.</li>
<li>maven archetype is a fork of the AEM archetype and adds react support and examples.</li>
<li>demo content package provides examples for components and SPA.</li>
</ul>
<p>Maven artifact is available via <a href="http://search.maven.org/#search%7Cga%7C1%7Caem-react">maven central</a></p>
<h4>Javascript project</h4><p>The aem-react projects relies on the <a href="https://github.com/sinnerschrader/aem-react-js">aem-react-js subproject</a>, which provides
the basic javascript funtionality. It is
available as <a href="https://www.npmjs.com/package/aem-react-js">npm
 module</a>.</p>
<h4>Maven archetype project</h4><p>Lastly a <a href="https://github.com/sinnerschrader/aem-project-archetype">maven-archetype</a> is avilable to quickly create an AEM maven project including react components.
It is a fork of the existing offical <a href="https://github.com/Adobe-Marketing-Cloud/aem-project-archetype">AEM maven archetype</a>.</p>
<p>Maven artifact is available via <a href="http://search.maven.org/#search%7Cga%7C1%7Csinnerschrader">maven central</a></p>
<div class="bs-callout bs-callout-info"><h3>Version </h3><p>This documentation always describes the latest version (not release) of these projects.</p>
</div><h3>Prerequisites</h3><ul>
<li><code>&gt;=</code> Java 8 (Oracle JDK with nashorn engine)</li>
<li><code>&gt;=</code> AEM 6.0</li>
</ul>

                    <h2 id="nav_1">2 Getting Started</h2>
                    
                        <p>In this guide we will use the maven archetype to generate a project structure.
It already includes some demo content and react components.</p>
<p><em>Requirements</em></p>
<ul>
<li>Adobe Experience Manager 6 or higher</li>
<li>Apache Maven (3.x should do)</li>
</ul>
<p>The example react components are written in Typescript. The node build tools
are also assuming that you are developing in Typescript. If you want to use another dialect you need to
tewak the build scripts.</p>

                        <h3 id="subnav_1_0">2.1 First project</h3>
                        <p>To quickly get started we will use the maven archetype.</p>
<h4>1. create maven project</h4><pre><code class="lang-bash"> mvn archetype:generate \
  -<span class="ruby"><span class="hljs-constant">DarchetypeGroupId</span>=com.sinnerschrader.aem.react \
</span>  -<span class="ruby"><span class="hljs-constant">DarchetypeArtifactId</span>=aem-project-archetype \
</span>  -<span class="ruby"><span class="hljs-constant">DarchetypeVersion</span>=<span class="hljs-number">10.2</span> \</span>
</code></pre>
<p> You will then be asked a couple of questions about project name and folder names and so on.
 These are the same as in the original archetype. Please find detailed
 explanations <a href="https://docs.adobe.com/docs/en/aem/6-0/develop/dev-tools/ht-projects-maven.html">here</a> in the section &quot;Getting started in
 5 minutes&quot;.</p>
<p><strong>Available properties</strong></p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>groupId</th>
<th>Maven GroupId</th>
</tr>
</thead>
<tbody>
<tr>
<td> groupId</td>
<td>Base Maven groupId</td>
</tr>
<tr>
<td> artifactId</td>
<td>Base Maven ArtifactId</td>
</tr>
<tr>
<td> version</td>
<td>Version</td>
</tr>
<tr>
<td> package</td>
<td>Java Source Package</td>
</tr>
<tr>
<td> appsFolderName</td>
<td>/apps folder name</td>
</tr>
<tr>
<td> artifactName</td>
<td>Maven Project Name</td>
</tr>
<tr>
<td> componentGroupName</td>
<td>AEM component group name</td>
</tr>
<tr>
<td> contentFolderName</td>
<td>/content folder name</td>
</tr>
<tr>
<td> cssId</td>
<td>prefix used in generated css</td>
</tr>
<tr>
<td> packageGroup</td>
<td>Content Package Group name</td>
</tr>
<tr>
<td> siteName</td>
<td>AEM site name</td>
</tr>
</tbody>
</table>
<h4>2. start AEM</h4><p> AEM should now be running.</p>
<h4>3. install demo</h4><pre><code class="lang-bash"> <span class="hljs-keyword">mvn </span>install -PautoInstallPackage
</code></pre>
<p>If your AEM instance is not running on localhost:4503 then you need to add additonal parameter</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>parameter</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>-Daem.port</td>
<td>4502</td>
</tr>
<tr>
<td>-Daem.host</td>
<td>localhost</td>
</tr>
</tbody>
</table>
<h4>4. Open browser</h4><p>To check what was deployed we will use the Classic UI.</p>
<ul>
<li>go to the page /content/${siteName}/en.html</li>
<li>find react components in sidekick: <em>React Panel</em>, <em>React Text</em> and <em>ReactParsys</em></li>
<li>find components already on the page</li>
</ul>
<p><div class="center-block caption-fix">
    <img src="page_sidekick.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >The page en.html with sidekick</p>
    </div>
</div></p>
<h4>5. disable author mode</h4><p>To check that we have actual react components in the page we will use the Classic UI.</p>
<ul>
<li>Disabled the author mode by appending <code>?wcmmode=disabled</code> to the url.</li>
<li>Install your <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">react dev tool</a> in
chrome browser.</li>
<li>Have a look at react component tree.</li>
</ul>
<p><div class="center-block caption-fix">
    <img src="page_dev_tool.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >The page en.html with react dev tools</p>
    </div>
</div></p>
<p>There are two <em>RootComponents</em> which means two independent react component trees.
The first contains the <em>Text</em> component.
The second contains the <em>Panel</em> which is a vanilla react component and therefore wrapped by a <em>TheWrapper</em> component.
The Panel&#39;s child is a <em>ReactParsys</em> which contains another <em>Text</em> component and a non-react component which inserted by the
<em>ResourceInclude</em> component.</p>

                        <h3 id="subnav_1_1">2.2 First component</h3>
                        <p>This part assumes that the project was created according to the previous chapter.</p>
<h4>1. Start watch task</h4><p>Start the watch task which transpiles, bundles and uploads the javascript files to AEM.</p>
<p>Open console to folder /src/main/ts and run the watch task  <code>npm run watch</code>.</p>
<p>If your AEM instance is not running on localhost:4502 then you need to make these configurations:</p>
<pre><code class="lang-bash">npm config <span class="hljs-operator"><span class="hljs-keyword">set</span> demo:crx <span class="hljs-keyword">http</span>://<span class="hljs-keyword">admin</span>:<span class="hljs-keyword">admin</span>@localhost:<span class="hljs-number">4502</span>/crx/repository/crx.<span class="hljs-keyword">default</span></span>
</code></pre>
<p>Alternatively the config in the package.json can be modified.</p>
<h4>2. create file</h4><p>Create a file MyComponent.tsx under /ui.apps/src/main/ts/.</p>
<pre><code class="lang-typescript">

<span class="scala"><span class="hljs-keyword">import</span> {<span class="hljs-type">ResourceComponent</span>} from <span class="hljs-string">"aem-react-js/component/ResourceComponent"</span>;
<span class="hljs-keyword">import</span> * as <span class="hljs-type">React</span> from <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-type">Text</span> from <span class="hljs-string">"../text/text"</span>;

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">ResourceComponent&lt;any</span>, <span class="hljs-title">any</span>, <span class="hljs-title">any&gt;</span> {</span>
    public renderBody(): <span class="hljs-type">React</span>.<span class="hljs-type">ReactElement</span>&lt;any&gt; {

        let label: string = <span class="hljs-keyword">this</span>.getResource().label;
        <span class="hljs-keyword">return</span> (
            &lt;div&gt;
                &lt;span&gt;<span class="hljs-type">Hello</span> {label}&lt;/span&gt;
                &lt;<span class="hljs-type">Text</span> path=<span class="hljs-string">"text"</span>/&gt;
            &lt;/div&gt;
        );
    }
}</span>
</code></pre>
<h4>3. Register component</h4><p>The component needs to be associated with a resourceType <code>${appsFolderName}</code>/components/my-component.
Open /ui.apps/src/main/ts/componentRegistry.tsx and add two lines</p>
<pre><code class="lang-typescript"> <span class="hljs-comment">// add this line at the top</span>
 <span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">"./MyComponent"</span>;
 ...
 <span class="hljs-comment">// add this line after componentRegistry is instantiated</span>
 componentRegistry.register(MyComponent);
</code></pre>
<h4>4. Create component configuration</h4><p>Create the component configuration in the appropriate folder <code>/apps/${appsFolderName}/components/my-component</code>.
The template is an empty file called <code>my-component.jsx</code>. The edit dialog should
provide a textfield for the property <code>./label</code>.</p>
<ul>
<li>/apps/${appsFolderName}/components/my-component<ul>
<li>.content.xml</li>
<li>my-component.jsx</li>
<li>dialog.xml</li>
</ul>
</li>
</ul>
<h4>5. Synchronize source code to crx</h4><p>The component configuration must be uploaded to crx. This can be done
via maven install -PautoInstallPackage. The watch task has already uploaded the javascript file.</p>
<h4>6. Open browser</h4><p> find the new react component in the sidekick.</p>
<h4>7. Continuely improve component</h4>
                        <h3 id="subnav_1_2">2.3 Demo</h3>
                        
                            <p>The aem-react project contains a demo content package.</p>
<h4>To run the demo</h4><ol>
<li><p>Clone git repo</p>
<pre><code class="lang-bash">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/sinnerschrader/aem-react.git
</code></pre>
</li>
<li><p>Install into running AEM</p>
<pre><code class="lang-bash"><span class="hljs-title">mvn</span> install -<span class="hljs-type">PautoInstallPackage</span> -<span class="hljs-type">Daem</span>.<span class="hljs-foreign"><span class="hljs-keyword">port</span>=&lt;<span class="hljs-keyword">port</span>&gt; -Daem.host=&lt;host&gt;</span>
</code></pre>
</li>
</ol>
<div class="bs-callout bs-callout-warning"><p>
Currently it is not possible to run the demo and the archetype in the same
AEM. You need to adjust the path to the javascript in the react script engine via the webconsole.</p>
</div><h4>SPA with a two level page hierachy</h4><p>Local url: <a href="localhost:4502/editor.html/content/reactdemo/cities.html">/content/reactdemo/cities.html</a></p>
<p>The SPA (single page application) is based on the <a href="https://github.com/ReactTraining/react-router">react router library</a>.
The SPA has a welcome view (/cities.html) and a detail view for each
city (e.g.: /cities/hamburg.html).</p>
<p><div class="center-block caption-fix">
    <img src="cities.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >Welcome view</p>
    </div>
</div></p>
<p><div class="center-block caption-fix">
    <img src="detail.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >Detail view</p>
    </div>
</div></p>
<p>The main AEM react component is <code>CityFinder</code>.
A city can be selected from the list on the left.
This list is part of the <code>CityListView</code> react component which is displayed on all views.
Its child component is either <code>Home</code> for the welcome view or <code>CityView</code> for the detail view.
In the author mode each view is a single AEM page. Each page contains the CityFinder
 component which contains the router. <code>Home</code> and <code>CityListView</code> are plain react components while CityFinder and CityView are AEM react
 components.</p>
<p>A simplified version of <code>CityFinder</code> looks like this:</p>
<pre><code class="lang-jsx">export default class CityFinder {
  renderBody() {
    return (

      <span class="hljs-tag">&lt;<span class="hljs-title">Router</span> <span class="hljs-attribute">history</span>=<span class="hljs-value">{history}</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">Route</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">"cities.html"</span> <span class="hljs-attribute">component</span>=<span class="hljs-value">{CityListView}</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-title">IndexRoute</span> <span class="hljs-attribute">component</span>=<span class="hljs-value">{Home}</span> <span class="hljs-attribute">baseResourcePath</span>=<span class="hljs-value">{resourcePath}</span>/&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-title">Route</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">"cities/(:name).html"</span> <span class="hljs-attribute">resourceComponent</span>=<span class="hljs-value">{CityView}</span> <span class="hljs-attribute">component</span>=<span class="hljs-value">{ResourceRoute}</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">Route</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">Router</span>&gt;</span>

    );
   }
}
</code></pre>
<p> The purpose of the generic <code>ResourceRoute</code> component is to translate the current
 routes dynamic path into a resource path which is passed to <code>CityView</code>.</p>
<h4>Component list</h4><p> Local url: <a href="localhost:4502/editor.html/content/reactdemo/overview.html">/content/reactdemo/overview.html</a></p>
<p> The list of components  include:</p>
<ul>
<li>simple text component</li>
<li>embedded component</li>
<li>accordion component which shows client-side interactivity and serves as a container.</li>
<li>vanilla component</li>
<li>vanilla panel which serves as a container</li>
</ul>
<p><div class="center-block caption-fix">
    <img src="demo_overview.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >Overview of example components</p>
    </div>
</div></p>

                    <h2 id="nav_2">3 Development Guide</h2>
                    
                        <h3 id="subnav_2_0">3.1 ResourceComponent</h3>
                        <p>ResourceComponent is the base class for AEM components. It provides access to the
resource (content). It also adds the necessary wrapper element, so that the component
can be edited in the author mode.</p>
<p>The main method to implement in a ResourceComponent is <code>renderBody()</code>. It is called
by the <code>render</code> method once the resource is successfully fetched. The resource is available via <code>this.getResource()</code>.</p>
<pre><code class="lang-typescript">
<span class="hljs-keyword">import</span> {ResourceComponent} <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/component/ResourceComponent"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> Text <span class="hljs-keyword">from</span> <span class="hljs-string">"../text/text"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResourceComponent</span>&lt;<span class="hljs-title">any</span>, <span class="hljs-title">any</span>, <span class="hljs-title">any</span>&gt; </span>{
    public renderBody(): React.ReactElement&lt;any&gt; {

        <span class="hljs-keyword">let</span> label: string = <span class="hljs-keyword">this</span>.getResource().label;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">span</span>&gt;</span>Hello {label}<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        )</span>;
    }
}
</code></pre>
<h4>Container</h4><p>If the component is a container then it must to render its children by itself. One option is to call <code>renderChildren</code> which
turns the component into a parsys like container for any child components. If the child components are restricted to a certain type
  then a custom rendering might be a better solution.</p>
<pre><code class="lang-typescript">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">renderBody</span>(<span class="hljs-params"></span>): React.ReactElement&lt;any&gt; </span>{

    <span class="hljs-keyword">let</span> label: <span class="hljs-keyword">string</span> = <span class="hljs-keyword">this</span>.getResource().label;
    <span class="hljs-keyword">let</span> children: React.ReactElement&lt;any&gt;[] =<span class="hljs-keyword">this</span>.renderChildren(<span class="hljs-keyword">this</span>.getResource(), <span class="hljs-string">"children"</span>);
    <span class="hljs-keyword">return</span> (
        &lt;div&gt;
            &lt;span&gt;Hello {label}&lt;/span&gt;
            {children}
        &lt;/div&gt;
    );
}
</code></pre>

                        <h3 id="subnav_2_1">3.2 Registering react component</h3>
                        <p>There must be one instance of <code>RootComponentRegistry</code>. It is responsible for mapping each React component to a resourceType.
A component is a registered with one of the <code>ComponentRegistry</code>s which are maped to a resource path.</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> ComponentRegistry <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/ComponentRegistry"</span>;
<span class="hljs-keyword">import</span> RootComponentRegistry <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/RootComponentRegistry"</span>;
<span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">"./MyComponent"</span>;

<span class="hljs-keyword">let</span> registry: ComponentRegistry = <span class="hljs-keyword">new</span> ComponentRegistry(<span class="hljs-string">"yourproject/components"</span>);
registry.register(MyComponent); <span class="hljs-comment">// resource type of MyComponent is 'yourproject/components/my-component'</span>

<span class="hljs-keyword">let</span> rootComponentRegistry: RootComponentRegistry = <span class="hljs-keyword">new</span> RootComponentRegistry();
rootComponentRegistry.add(componentRegistry);
rootComponentRegistry.init();
AemGlobal.registry = rootComponentRegistry; <span class="hljs-comment">// expose registry to Nashorn</span>
</code></pre>
<p>If your project was created by the maven archetpye then the RootComponentRegistry is already instantiated and you just need to add your <code>ComponentRegistry</code>.`</p>

                        <h3 id="subnav_2_2">3.3 Loading Resource</h3>
                        <p>The resource will be loaded as json by calling <code>getResource()</code> and therefore the number of levels of the resource tree need to be defined
 in
advance by
overriding the method <code>getDepth()</code>. In accordance with the sling conventions 0 means a single level.</p>
<pre><code class="lang-typescript">     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">getDepth</span>(<span class="hljs-params"></span>): number </span>{
         <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
     }
</code></pre>
<h4>Lazy Loading</h4><p>If the resource is not fetched synchronuously then the <code>render</code> method will call <code>renderLoading</code> instead to display a loading spinner or
similar ui.
Asynchronuous loading happens when a ResourceComponent&#39;s path prop is changed or a new ResourceComponent
is added to the resource tree in the client. This is often the case when the react router library is used.</p>
<pre><code class="lang-typescript">    <span class="hljs-keyword">public</span> renderLoading(): React.ReactElement&lt;<span class="hljs-built_in">any</span>&gt; {

        <span class="hljs-keyword">return</span> (
            &lt;span&gt;Loading <span class="hljs-type">data</span> ...&lt;/spany&gt;
        );
    }
</code></pre>

                        <h3 id="subnav_2_3">3.4 Author mode</h3>
                        <p>React components are not instantiated in the author mode to prevent anyy interference between AEM javascript
and react. For a lot of components this means that they need to be displayed differently. For example
an Accordion must display all panels and its corresponding parsys. Use <code>isWcmEnabled()</code> on the server
to detect the author mode.</p>

                        <h3 id="subnav_2_4">3.5 Java Api</h3>
                        <p>Presentation logic is often implemented in sling models. To access a sling model or an osgi service
the fully qualified java class name needs to be passed to appropriate method. The object returned is
a <code>aem-react-js/ServiceProxy</code>, which has a single method <code>invoke</code>. That method&#39;s first parameter is the
actual java method to invoke and the remaining parameters are passed to that method.</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>getResourceModel(className)</td>
<td>adapt the current resource to the given class name.</td>
</tr>
<tr>
<td>getRequestModel(className)</td>
<td>adapt the current request to the given class name.</td>
</tr>
<tr>
<td>getOsgiService(className)</td>
<td>get the osgi service by its service class name</td>
</tr>
</tbody>
</table>
<pre><code class="lang-typescript">    import ServiceProxy <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/ServiceProxy"</span>;
    ...
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">renderBody</span>(<span class="hljs-params"></span>): React.ReactElement&lt;any&gt; </span>{
        <span class="hljs-keyword">let</span> model: ServiceProxy = <span class="hljs-keyword">this</span>.getRequestModel(`com.example.LabelModel`);
        <span class="hljs-keyword">let</span> label: <span class="hljs-keyword">string</span> = model.invoke(<span class="hljs-string">'getLabel'</span>)
        <span class="hljs-keyword">return</span> (
            &lt;div&gt;
                &lt;span&gt;Hello {label}&lt;/span&gt;
            &lt;/div&gt;
        );
    }
</code></pre>
<p>The Java API methods will be invoked only if the component&#39;s is rendered on the server.
Otherwise the return value is served from the cache which was created during server rendering.
It is safe to invoke a java method in the <code>renderBody</code> method. But it must be invoked
unconditionally and always with the same parameters. Initially <code>renderBody</code> will always be invoked on the server but
it can be invoked on the client many times after that.</p>
<p> If a service is needed to load data based on user input then you should not
 use the Java api but use a custom http service via plain ajax.</p>

                        <h3 id="subnav_2_5">3.6 Vanilla component</h3>
                        <p>A vanilla react component can be registered
as a AEM component as well.</p>
<pre><code class="lang-typescript"><span class="hljs-tag">registry</span><span class="hljs-class">.registerVanilla</span>(<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">component</span>:<span class="hljs-value"> TextField</span></span></span>});
<span class="hljs-tag">registry</span><span class="hljs-class">.registerVanilla</span>(<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">component</span>:<span class="hljs-value"> Panel, parsys: {path: <span class="hljs-string">"content"</span></span></span></span>}, <span class="hljs-tag">depth</span>: 2});
</code></pre>
<p>All resource properties are passed as props to the component.</p>
<p>For a simple component that only needs a single level of the resource tree
 and doesn&#39;t display children it is sufficient to define the React component class
 that should be registered. The following additional parameters are available</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>parameter</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td> depth</td>
<td>number</td>
<td>the number of levels of the resource available</td>
</tr>
<tr>
<td> props?</td>
<td>any</td>
<td>extra props that are passed</td>
</tr>
<tr>
<td> parsys?</td>
<td>object</td>
<td>define this property to define a parsys as the only child of this component</td>
</tr>
<tr>
<td> parsys.path</td>
<td>string</td>
<td>the relative content path to store children </td>
</tr>
<tr>
<td> parsys.className?</td>
<td>string</td>
<td>class name added to the parsys element</td>
</tr>
<tr>
<td> parsys.elementName?</td>
<td>string</td>
<td>name of the parsys element (default is &quot;div&quot;)</td>
</tr>
<tr>
<td> parsys.childElementName?</td>
<td>string</td>
<td>If provided each child is wrapped in an extra element</td>
</tr>
<tr>
<td> parsys.childClassName?</td>
<td>string</td>
<td>class name added to children elements.</td>
</tr>
<tr>
<td> transform?</td>
<td>function</td>
<td>a function to tranform the resource into react props</td>
</tr>
</tbody>
</table>
<h4>Container</h4><p> If the <code>parsys</code> property is set then the vanilla component will be turned into
 an AEM container. The <code>.content.xml</code> must also set the corresponding attribute:</p>
<pre><code class="lang-xml"> <span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">jcr:root</span> <span class="hljs-attribute">xmlns:sling</span>=<span class="hljs-value">"http://sling.apache.org/jcr/sling/1.0"</span> <span class="hljs-attribute">xmlns:cq</span>=<span class="hljs-value">"http://www.day.com/jcr/cq/1.0"</span> <span class="hljs-attribute">xmlns:jcr</span>=<span class="hljs-value">"http://www.jcp.org/jcr/1.0"</span>
     <span class="hljs-attribute">jcr:primaryType</span>=<span class="hljs-value">"cq:Component"</span>
     <span class="hljs-attribute">jcr:title</span>=<span class="hljs-value">"My Title"</span>
     <span class="hljs-attribute">cq:isContainer</span>=<span class="hljs-value">"true"</span>
     /&gt;</span>
</code></pre>
<h4>Resource transformation</h4><p>If the resource&#39;s structure does not match the props of the vanilla component then a transformation can be used.
A transformation is a function that is passed the resource and the resourceComponent and returns the props that will be passed to
the react component.</p>
<p>In this example a sling model is used in the transformation:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">let</span> transform: <span class="hljs-built_in">any</span> = (resource: <span class="hljs-built_in">any</span>, wrapper: ResourceComponent&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;) =&gt; {
    <span class="hljs-keyword">let</span> model: ServiceProxy = r.getResourceModel(<span class="hljs-string">"demop.core.models.MyModel"</span>);
    <span class="hljs-keyword">let</span> newProps: <span class="hljs-built_in">any</span> = {title: resource.label};
    newProps[<span class="hljs-string">"imageSrc"</span>] = model.invoke(<span class="hljs-string">"getImageSrc"</span>);
    <span class="hljs-keyword">return</span> newProps;
};

registry.registerVanilla({
    component: myComponent, transform: transform
});
</code></pre>

                    <h2 id="nav_3">4 Tools</h2>
                    
                        <p>This section describes the development tools for react components that are
installed in projects created with the maven archetype.
The tools are installed in the directory <code>ui.apps/src/main/ts</code>.</p>

                        <h3 id="subnav_3_0">4.1 Build Task</h3>
                        <p>The build task transpiles all typescript files and bundles them into two javascript files and copies them into the appropriate
target folder in the <code>ui.apps</code> project <code>ui.apps/target/classes/etc/designs/${appsFolderName}/clientlib-site/</code>:</p>
<ul>
<li>reactClient.js</li>
<li>reactServer.js</li>
</ul>
<pre><code> npm <span class="hljs-command">run</span> start
</code></pre>
                        <h3 id="subnav_3_1">4.2 Watch Task</h3>
                        <p>The watch task will watch files in the target folder of the ui.apps project and deploys
them in to AEM. Start the watch task with <code>npm run watch</code>. To configure the address of the running AEM instance
you need to use npm:</p>
<pre><code class="lang-bash">npm config <span class="hljs-operator"><span class="hljs-keyword">set</span> demo:crx <span class="hljs-keyword">http</span>://<span class="hljs-keyword">admin</span>:<span class="hljs-keyword">admin</span>@localhost:<span class="hljs-number">4502</span>/crx/repository/crx.<span class="hljs-keyword">default</span></span>
</code></pre>
<p>All typescript files are watched and automatically as described in the previous chapter to two javascript files.
All files below <code>ui.apps/target/classes/etc/designs/${appsFolderName}</code> are watched and deployed into AEM. This includes both the
transpiled javascript files.</p>

            </div>
            <div class="col-md-3">
                <nav id="navigation" class="bs-docs-sidebar">
                    <ul class="nav bs-docs-sidenav">
                            <li>
                                <a href="#nav_0">1 Introduction</a>
                            </li>
                            <li>
                                <a href="#nav_1">2 Getting Started</a>
                                <ul class="nav">
                                        <li>
                                            <a href="#subnav_1_0">2.1 First project</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_1_1">2.2 First component</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_1_2">2.3 Demo</a>
                                        </li>
                                </ul>
                            </li>
                            <li>
                                <a href="#nav_2">3 Development Guide</a>
                                <ul class="nav">
                                        <li>
                                            <a href="#subnav_2_0">3.1 ResourceComponent</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_2_1">3.2 Registering react component</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_2_2">3.3 Loading Resource</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_2_3">3.4 Author mode</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_2_4">3.5 Java Api</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_2_5">3.6 Vanilla component</a>
                                        </li>
                                </ul>
                            </li>
                            <li>
                                <a href="#nav_3">4 Tools</a>
                                <ul class="nav">
                                        <li>
                                            <a href="#subnav_3_0">4.1 Build Task</a>
                                        </li>
                                        <li>
                                            <a href="#subnav_3_1">4.2 Watch Task</a>
                                        </li>
                                </ul>
                            </li>
                    </ul>
                </nav>
            </div>
        </div>
        </div>
    <footer class="footer">
        <p>generated on Sun Nov 13 2016 11:07:48 GMT+0000 (UTC)</p>
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery/dist/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/dist/js/bootstrap.js"></script>
    <script>
        var headerHeight = document.querySelector(".js_header").getBoundingClientRect().height;
        var nav = $("#navigation");
        function checkScroll() {
            var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (headerHeight<scrollTop) {
                nav.addClass("affix");
            } else{
                nav.removeClass("affix");
            }
        }
        function runOnScroll() {
            checkScroll();
        }
        window.addEventListener("scroll", runOnScroll);
        $('body').scrollspy({target: '#navigation'})
        checkScroll();
    </script>
</body>
</html>
